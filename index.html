<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Recipe Collector</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { display: flex; align-items: center; margin-bottom: 20px; }
        .logo { width: 32px; height: 32px; margin-right: 10px; } /* Small size like Super Grok */
        .logo-text { font-size: 18px; font-weight: bold; }
        .prompt { width: 64%; padding: 10px; margin-bottom: 10px; } /* 80% of original 80% width = 64% */
        .comment-box { width: 64%; height: 200px; padding: 10px; margin-bottom: 10px; resize: vertical; } /* Same width, 10x taller */
        .add-button { padding: 30px 60px; font-size: 24px; margin-bottom: 10px; } /* 3x bigger button */
        .view-recipes-button { padding: 10px 20px; font-size: 16px; text-decoration: none; color: white; background-color: #4CAF50; border: none; border-radius: 5px; cursor: pointer; }
        .view-recipes-button:hover { background-color: #45a049; }
        .message { display: none; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <div class="header">
        <img src="/cats-kitchen-logo.png" alt="Cat's Kitchen Logo" class="logo">
        <span class="logo-text">Cat's Kitchen</span>
    </div>
    <h1>Recipe Collector</h1>
    <input type="text" id="nameInput" class="prompt" placeholder="Enter recipe name (optional)">
    <input type="text" id="urlInput" class="prompt" placeholder="Enter recipe URL" required>
    <textarea id="commentInput" class="comment-box" placeholder="Enter notes about the meal"></textarea>
    <button class="add-button" onclick="addRecipe()">Add</button>
    <br>
    <a href="/recipes.html" class="view-recipes-button">View Recipes</a>
    <div id="message" class="message"></div>

    <script>
        // Set the API base URL (change this for local vs. deployed)
        //const API_BASE_URL = 'http://localhost:7071'; // For local testing
        const API_BASE_URL = ''; // For deployed app (relative URL)

        async function addRecipe() {
            const url = document.getElementById('urlInput').value;
            let name = document.getElementById('nameInput').value.trim();
            const comment = document.getElementById('commentInput').value.trim();
            const messageElement = document.getElementById('message');

            // Clear previous message
            messageElement.textContent = '';
            messageElement.style.display = 'none';
            messageElement.classList.remove('success', 'error');

            if (!url) {
                messageElement.textContent = 'Please enter a URL';
                messageElement.classList.add('error');
                messageElement.style.display = 'block';
                return;
            }

            // Set a default name if the user doesn't provide one
            if (!name) {
                name = "none";
            }

            try {
                const response = await fetch(`${API_BASE_URL}/api/addRecipe`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url, name, comment }) // Include comment in the payload
                });

                if (response.ok) {
                    messageElement.textContent = 'New recipe added!';
                    messageElement.classList.add('success');
                    messageElement.style.display = 'block';
                    setTimeout(() => {
                        messageElement.style.display = 'none';
                    }, 2000);
                    document.getElementById('urlInput').value = '';
                    document.getElementById('nameInput').value = '';
                    document.getElementById('commentInput').value = '';
                } else {
                    const errorText = await response.text();
                    messageElement.textContent = `Error adding recipe: ${response.status} - ${errorText}`;
                    messageElement.classList.add('error');
                    messageElement.style.display = 'block';
                }
            } catch (error) {
                messageElement.textContent = `Error: ${error.message}`;
                messageElement.classList.add('error');
                messageElement.style.display = 'block';
            }
        }
    </script>
    <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9282427f9f0412db',t:'MTc0MzI4MTYzOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>